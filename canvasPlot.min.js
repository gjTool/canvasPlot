(()=>{var e={894:function(e,t,i){var o,r,s,n;r="undefined"!=typeof window?window:this,s=function(e,t){"use strict";function i(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function o(e,t,i,o,r,s){o.save(),o.fillStyle=r,o.fillRect(e-i/2,t-i/2,i,i),o.fillStyle=s,o.fillRect(e-(i-3)/2,t-(i-3)/2,i-3,i-3),o.restore()}function r(e,t,i,o,r){if(s(e,i,r)&&s(t,o,r))return!0}function s(e,t,i){return Math.abs(e-t)<i}return function s(n){if("[object Object]"!==Object.prototype.toString.call(n))throw Error("new CanvasPlot(options). Parameter 'options' must be an object.");console.time("imgload");var l,a,d,c,f=document.createElement("canvas");this.version=t;var h=n.parentNode instanceof HTMLElement?n.parentNode:document.body,u=n.deleteBtnText||"删除",g=n.selectionBorderColor||"#00ff00",y=n.selectionBorderWidth||1,v=n.selectionRectColor||"#00ff00",p=n.selectionFillColor||"#ffffff",m=n.rectBgColor||"rgba(255, 255, 255, 0)",x=n.borderColor||"#0d0efd",w=n.imagePath||"",b=n.showMenu||!1,C=n.dragMoveButton||"middleClick",k=n.maxScale||3.5,L=n.minScale||.1;f.width=n.width||h.offsetWidth,f.height=n.height||h.offsetHeight;var S,z,M={x:f.width/2,y:f.height/2},I=h.querySelector("canvas");I&&h.removeChild(I),h.appendChild(f);var R=f.getContext("2d");R.imageSmoothingEnabled=!0;var E=0,T=0;e&&e.getComputedStyle&&(E=parseFloat(e.getComputedStyle(f).borderLeftWidth)||0,T=parseFloat(e.getComputedStyle(f).borderTopWidth)||0);var P,B,A,F,j,O,W,X,Y=Te(h).offsetX,N=Te(h).offsetY,D=document.body.parentNode,H=D.offsetTop,U=D.offsetLeft,V=!1,q=[],G=!0,Q=!1,K=null,Z=!1,_=0,J=0,$={x:0,y:0},ee={x:0,y:0},te=n.drawingType||"rect",ie=!1,oe=null,re=null,se=null,ne=null,le=0,ae={},de=n.chunkImage||!1,ce=n.chunkSize||512,fe=n.chunkRatio||.5,he=[],ue=!1,ge={},ye=this;if(b){if(ue)return;var ve=document.createElement("div");ve.className="right_menu",ve.style.position="absolute",ve.style.background="#ffffff",ve.style.border="solid 1px  #ebeef5",ve.style.display="none",ve.style.borderRadius="4px",ve.style.boxShadow="0 2px 12px 0 rgb(0 0 0 / 10%)",h.appendChild(ve),ve.addEventListener("click",function(e){var t=e.target;if("li"===t.nodeName.toLowerCase()){var i=t.getAttribute("index");0==i&&(ye.delPlot(K),K=null,ve.style.display="none"),1==i&&(ve.style.display="none")}},!0)}var pe=function(e,t=30){let i=0;return function(){const o=Date.now();o-i>=t&&(e.apply(this,arguments),i=o)}};f.addEventListener("selectstart",function(e){return e.preventDefault(),!1},!1),f.oncontextmenu=pe(function(e){if(!(ue||(e.preventDefault(),ve&&(ve.style.display="none"),K&&K.disabled||K&&(K.dragging||K.resizing)))){if("rect"===te){var t=(s=ye.getMouse(e)).x,i=s.y;t+=(n=ze()).x,i+=n.y,b&&(ve.style.display="none");for(var o=!1,r=(l=q).length-1;r>=0;r--)if((a=l[r]).contains(t,i)&&!1===o){if(a.disabled)return a.selected=!1,a.delselected=!1,V=!1,K=null,!1;K=a,a.selected=!0,a.delselected=!0,V=!1,o=!0,b&&we(e),ye.fire("rightClick",e,K)}else a.selected=!1,a.delselected=!1,V=!1;!1===o&&(K=null)}if("text"===te){var s,n,l;for(t=(s=ye.getMouse(e)).x,i=s.y,t+=(n=ze()).x,i+=n.y,b&&(ve.style.display="none"),o=!1,r=(l=q).length-1;r>=0;r--){var a;if((a=l[r]).contains(t,i)&&!1===o){if(a.disabled)return a.selected=!1,a.delselected=!1,V=!1,K=null,!1;K=a,a.selected=!0,a.delselected=!0,V=!1,o=!0,b&&we(e),ye.fire("rightClick",e,K)}else a.selected=!1,a.delselected=!1,V=!1}!1===o&&(K=null)}return!1}}),f.addEventListener("mousedown",function(e){if(!ue){K=null;var t=2,i=1;if("rightClick"===C?(t=2,i=1):"middleClick"===C&&(t=1,i=2),ve&&(ve.style.display="none"),e.button!==i){var o=(s=ye.getMouse(e)).x,r=s.y;if(M.x=o,M.y=r,G&&e.button===t){var s;o=(s=ye.getMouse(e)).x,r=s.y,document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none",S=R.transformedPoint(o,r),z=!1,f.addEventListener("mousemove",ke),f.addEventListener("mouseup",Le)}else{var n=ze();o+=n.x,r+=n.y,R.strokeStyle=x,R.lineWidth=y;var l=q,a=l.length,d=!1;if("rect"===te){for(var c=a-1;c>=0;c--)if((h=l[c]).contains(o,r)&&!1===d){if(h.disabled)return K=null,h.delselected=!1,h.selected=!1,void(V=!1);(K=h).dragging=!0,_=o-h.x*n.scale,J=r-h.y*n.scale,K===h&&(l[c].getCheckSideLengthResult(o,r)?(Se(e,h),K.resizing=!0,K.dragging=!1):K.resizing=!1),h.delselected=!1,h.selected=!0,V=!1,d=!0}else h.delselected=!1,h.selected=!1,V=!1;if(!1===d&&(K=null),K&&(f.style.cursor="move",ye.toTop(K)),K&&(K.dragging||K.resizing))return;$.x=e.offsetX,$.y=e.offsetY,f.addEventListener("mousemove",be),f.addEventListener("mouseup",Ce)}else if("text"===te)if(K)ie?(ie=!1,Q=!1,f.style.cursor="auto",K=null,f.removeEventListener("mousemove",be),f.removeEventListener("mouseup",Ce)):(f.style.cursor="move",Q=!0);else{for(c=a-1;c>=0;c--)if((h=l[c]).contains(o,r)&&!1===d){if(h.disabled)return K=null,h.delselected=!1,h.selected=!1,void(V=!1);(K=h).dragging=!0,_=o-h.x*n.scale,J=r-h.y*n.scale,K===h&&(l[c].getContainsTextResult(o,r)&&!ie?(Se(e,h),K.resizing=!0,K.dragging=!0):K.resizing=!1),h.delselected=!1,h.selected=!0,V=!1,d=!0}else h.delselected=!1,h.selected=!1,V=!1;if(!1===d&&(K=null),K&&(f.style.cursor="auto",ye.toTop(K)),K&&(K.dragging||K.resizing))return;$.x=e.offsetX,$.y=e.offsetY,Q=!0,f.addEventListener("mousemove",be),f.addEventListener("mouseup",Ce)}else{for(c=a-1;c>=0;c--){var h;if((h=l[c]).contains(o,r)&&!1===d){if(h.disabled)return K=null,h.delselected=!1,h.selected=!1,void(V=!1);(K=h).dragging=!0,_=o-h.x*n.scale,J=r-h.y*n.scale,K===h&&(l[c].getContainsTextResult(o,r)?(Se(e,h),K.resizing=!0,K.dragging=!1):K.resizing=!1),h.delselected=!1,h.selected=!0,V=!1,d=!0}else h.delselected=!1,h.selected=!1,V=!1}if(!1===d&&(K=null),K&&(f.style.cursor="move",ye.toTop(K)),K&&(K.dragging||K.resizing))return;$.x=e.offsetX,$.y=e.offsetY,f.addEventListener("mousemove",be),f.addEventListener("mouseup",Ce)}}}}},!0),f.addEventListener("mousemove",pe(function(e){if(!ue&&1!==e.button){var t=ye.getMouse(e),i=t.x,o=t.y;if(M.x=i,M.y=o,!K||!K.disabled||ie){if("rect"===te){i+=(s=ze()).x,o+=s.y,K&&K.dragging?(K.x=(i-_)/s.scale,K.y=(o-J)/s.scale,V=!1,ye.fire("dragPlotMove",K)):this.style.cursor="auto",K&&K.resizing&&function(e,t){if(!ue){var i=ze(),o=ye.getMouse(e),r=(o.x+i.x)/i.scale,s=(o.y+i.y)/i.scale,n=t.x,l=t.y,a=t.w,d=t.h;"rect"===te&&(P?(e.target.style.cursor="nw-resize",n+a-r<0&&(P=!1,A=!0),l+d-s<0&&(P=!1,j=!0),t.w+=n-r,t.h+=l-s,t.x=r,t.y=s):B?(e.target.style.cursor="n-resize",n-r>0&&(B=!1,O=!0),l+d-s<0&&(B=!1,O=!0),t.h+=l-s,t.y=s):A?(e.target.style.cursor="ne-resize",n-r>0&&(A=!1,P=!0),l+d-s<0&&(A=!1,W=!0),t.w=Math.abs(n-r),t.h+=l-s,t.y=s):F?(e.target.style.cursor="e-resize",n-r>0&&(F=!1,X=!0),l+d-s<0&&(F=!1,X=!0),t.w+=r-n-a):j?(e.target.style.cursor="sw-resize",n+a-r<0&&(j=!1,W=!0),l-s>0&&(j=!1,P=!0),t.w+=n-r,t.h=Math.abs(l-s),t.x=r):O?(e.target.style.cursor="s-resize",n-r>0&&(O=!1,B=!0),l-s>0&&(O=!1,B=!0),t.h+=s-l-d):W?(e.target.style.cursor="se-resize",n-r>0&&(W=!1,j=!0),l-s>0&&(W=!1,A=!0),t.w=Math.abs(n-r),t.h=Math.abs(l-s)):X&&(e.target.style.cursor="w-resize",n+a-r<0&&(X=!1,F=!0),l+d-s<0&&(X=!1,F=!0),t.w+=n-r,t.x=r),V=!1,ye.fire("drawMove",K)),"text"===te&&(V=!1,ye.fire("drawMove",K))}}(e,K);for(var r=(n=q).length-1;r>=0;r--)if((l=n[r]).contains(i,o)){if(l.disabled)return;if(K===l)switch(l.getCheckSideLengthResult(i,o)){case"topL":e.target.style.cursor="nw-resize";break;case"topM":e.target.style.cursor="n-resize";break;case"topR":e.target.style.cursor="ne-resize";break;case"rightM":case"rightM":e.target.style.cursor="e-resize";break;case"bottomL":e.target.style.cursor="sw-resize";break;case"bottomM":e.target.style.cursor="s-resize";break;case"bottomR":e.target.style.cursor="se-resize";break;case"leftM":e.target.style.cursor="w-resize";break;default:this.style.cursor="move"}break}}var s,n;if("text"===te)for(i+=(s=ze()).x,o+=s.y,K&&ie?(K.x=(i-_)/s.scale,K.y=(o-J)/s.scale,K.selected=!1,this.style.cursor="auto",V=!1):K&&K.dragging?(K.x=(i-_)/s.scale,K.y=(o-J)/s.scale,V=!1):this.style.cursor="auto",r=(n=q).length-1;r>=0;r--){var l=n[r];if(K===l&&(l.x=K.x,l.y=K.y),l.contains(i,o)){if(l.disabled)return;K===l&&(l.getContainsTextResult(i,o),this.style.cursor=ie&&Q?"auto":"move");break}}}}}),!0),f.addEventListener("mouseup",function(e){if(!ue&&1!==e.button){var t=ye.getMouse(e),i=t.x,o=t.y;if(M.x=i,M.y=o,G&&2===e.button);else{if(K&&K.disabled)return;if(K){if(K.dragging=!1,K.resizing=!1,ie&&Q)return ie=!1,Q=!1,f.style.cursor="auto",void(K=null);ue||("rect"===te&&(P=B=A=F=j=O=W=X=!1),ye.fire("select",K))}}this.style.cursor="auto"}},!0),f.addEventListener("dblclick",function(e){ue||1!==e.button&&(K&&K.disabled||K&&(K.dragging||K.resizing)||ye.fire("dblclick",K))},!0);var me=function(e){if(!ue&&G){if(1==e)return;if((o=ze()).scale<=L&&e<=-.6)return;if(o.scale>=k&&e>=.6)return;var t=R.transformedPoint(M.x,M.y);R.translate(t.x,t.y);var i=Math.pow(1.1,e);R.scale(i,i),R.translate(-t.x,-t.y);var o=ze();xe(),ye.fire("zoom",o)}};function xe(){ue||(ye.clear(),R.save(),R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,f.width,f.height),R.restore(),V=!1,ye.draw())}function we(e){if(!ue){var t=h.getBoundingClientRect(),i=e.clientX-t.left,o=e.clientY-t.top;e.cancelBubble=!0,ve.innerHTML='<ul style="margin: 0;padding: 10px 0;list-style: none;font-size:12px;"><li index="0" style="padding: 0px 10px;cursor: pointer;color:red;">'+u+"</li></ul>",ve.style.left=i+"px",ve.style.top=o+"px",ve.style.display="block"}}function be(e){if(!ue&&1!==e.button&&Q){var t=ze();if(ee.x=e.offsetX,ee.y=e.offsetY,"rect"===te){var i=Math.abs($.x-ee.x),o=Math.abs($.y-ee.y);ye.clear(),R.beginPath(),l=$.x,a=$.y,ee.x>=l?ee.y>=a?(d=i,c=o):(d=i,c=-o):ee.y>=a?(d=-i,c=o):(d=-i,c=-o),V=!1,ye.draw(),l+=t.x,a+=t.y,l/=t.scale,a/=t.scale,d/=t.scale,c/=t.scale,R.strokeRect(l,a,d,c),R.fillStyle=m,R.fillRect(l,a,d,c),ye.fire("drawing",K)}"text"===te&&(i=Math.abs($.x-ee.x),o=Math.abs($.y-ee.y),ye.clear(),R.beginPath(),l=$.x,a=$.y,ee.x>=l?ee.y>=a?(d=i,c=o):(d=i,c=-o):ee.y>=a?(d=-i,c=o):(d=-i,c=-o),V=!1,ye.draw(),l+=t.x,a+=t.y,l/=t.scale,a/=t.scale,d/=t.scale,c/=t.scale,ye.fire("drawing",K))}}function Ce(e){var t;ue||1!==e.button&&("rect"===te&&((d<0||c<0)&&(l+=d,a+=c,d=-d,c=-c),void 0!==l&&void 0!==a&&void 0!==d&&void 0!==c&&d>=5&&c>=5&&ye.addPlot({x:l,y:a,w:d,h:c,color:m,type:"rect"}),t={},q=q.reduce(function(e,i){return!t[i.uuid]&&(t[i.uuid]=e.push(i)),e},[]),f.removeEventListener("mousemove",be),Z&&(Q=!1),f.removeEventListener("mouseup",Ce),l=void 0,a=void 0,d=void 0,c=void 0,$={x:0,y:0},ee={x:0,y:0}),"text"===te&&(Q=!1,ie=!1,f.removeEventListener("mousemove",be),f.removeEventListener("mouseup",Ce),l=void 0,a=void 0,d=void 0,c=void 0,$={x:0,y:0},ee={x:0,y:0}),ye.fire("drawFinish",K))}function ke(e){if(!ue&&G){var t=ye.getMouse(e),i=t.x,o=t.y;if(z=!0,S){var r=R.transformedPoint(i,o);R.translate(r.x-S.x,r.y-S.y),xe()}}}function Le(e){ue||(ie=!1,Q=!1,G&&(ye.fire("dragMoveFinish",S),S=null,z||me(e.shiftKey?-1:1),f.removeEventListener("mousemove",ke),f.removeEventListener("mouseup",Le)))}function Se(e,t){if(!ue&&!t.disabled){var i=ze(),o=ye.getMouse(e),r=o.x+i.x,s=o.y+i.y;if("rect"===te){switch(t.getCheckSideLengthResult(r,s)){case"topL":P=!0,e.target.style.cursor="nw-resize";break;case"topM":B=!0,e.target.style.cursor="n-resize";break;case"topR":A=!0,e.target.style.cursor="ne-resize";break;case"rightM":case"rightM":F=!0,e.target.style.cursor="e-resize";break;case"bottomL":j=!0,e.target.style.cursor="sw-resize";break;case"bottomM":O=!0,e.target.style.cursor="s-resize";break;case"bottomR":W=!0,e.target.style.cursor="se-resize";break;case"leftM":X=!0,e.target.style.cursor="w-resize"}V=!1}}}function ze(){var e=R.getTransform();return{scale:e.d,x:-e.e,y:-e.f}}function Me(e){ue||(R.setTransform(e.scale,0,0,e.scale,-e.x,-e.y),xe())}f.addEventListener("mousewheel",pe(function(e){if(!ue&&G){var t=e.wheelDelta?e.wheelDelta/200:e.detail?-e.detail:0;return t&&me(t),ve&&(ve.style.display="none"),e.preventDefault()&&!1}}),!1),s.prototype.getOffset=ze,s.prototype.setOffset=Me,s.prototype.destroy=function(){ne&&(cancelAnimationFrame(ne),ne=null),this.clear(),h.removeChild(f),q=[],G=!0,Q=!1,K=null,Z=!1,_=0,J=0,$={x:0,y:0},ee={x:0,y:0},te=void 0,oe=null,re=null,se=null,ae=null,re=null,se=null,ge={},P=B=A=F=j=O=W=X=!1},s.prototype.render=function(){var e=this;ne&&(cancelAnimationFrame(ne),ne=null),ue||(ne=requestAnimationFrame(function t(i){if(i-le>=16.66){var o=ze();o&&o.scale>=3?R.imageSmoothingQuality="high":o&&o.scale>=1?R.imageSmoothingQuality="medium":R.imageSmoothingQuality="low",e.draw(),le=i}ne=requestAnimationFrame(t)}))},s.prototype.resize=function(){ue||(f.width=n.width||h.offsetWidth,f.height=n.height||h.offsetHeight,this.render(),Me(ze()))},s.prototype.getData=function(){return{offset:ze(),data:q}},s.prototype.setData=function(e){if(e.offset&&Me(e.offset),e.data)for(var t=0;t<e.data.length;t++)e.data[t].color=e.data[t].color||m,this.addRect(e.data[t]);setTimeout(()=>{e.offset&&Me(e.offset)},300)},s.prototype.getPlotCaches=function(){return q},s.prototype.getSelection=function(){return K};var Ie=function(e){he=[];const t=Math.max(e.width,e.height);let i=0;for(ce=n.chunkSize||512;ce<t;){const o=document.createElement("canvas"),r=o.getContext("2d"),s=ce/t,n=e.width/e.height;o.width=e.width*s,o.height=o.width/n,r.drawImage(e,0,0,e.width,e.height,0,0,o.width,o.height),i++,he.push({size:ce,chunkImg:o,with:o.width,height:o.height,ratio:s,level:i}),ce*=2}i++;const o=document.createElement("canvas"),r=o.getContext("2d");return o.width=e.width,o.height=e.width,r.drawImage(e,0,0,e.width,e.height,0,0,o.width,o.height),he.push({size:"original",chunkImg:o,with:o.width,height:o.height,ratio:1,level:i}),console.log("chunkImgCaches",he),e=null,he},Re=function(){if(!oe||!oe.cachedLevels)return null;const e=ze().scale,t=oe.cachedLevels.length;let i=oe.cachedLevels[0];for(const t of oe.cachedLevels)if(t.ratio>=e*fe){i=t;break}return e>1&&(i=oe.cachedLevels[t-1]),i};function Ee(e){var t=document.defaultView.getComputedStyle(e).transform;if("none"!==t){var i=t.replace(")","").split(",");return{l:Number(i[i.length-2]),t:Number(i[i.length-1]),flag:!0}}return{l:0,t:0}}function Te(e){var t=0,i=0,o=!1;if(void 0!==e.offsetParent)do{var r=Ee(e).l,s=Ee(e).t;t+=e.offsetLeft,i+=e.offsetTop,isNaN(r)||isNaN(s)||(t+=-r,i+=-s),Ee(e).flag&&(o=!0)}while(e=e.offsetParent);return{offsetX:t,offsetY:i,flag:o}}function Pe(){var e=Te(f).offsetX,t=Te(f).offsetY,i=Te(f).flag;return{left:Y-e,top:N-t,offsetX:e,offsetY:t,flag:i}}s.prototype.getChunkImgCaches=function(){return he},s.prototype.getCurrentImage=function(){return oe},s.prototype.getCanvas=function(){return f},s.prototype.getCtx=function(){return R},s.prototype.addImage=function(e,t,i){if(de){const r=Re();r&&r.chunkImg?void 0!==t&&void 0!==i?R.drawImage(r.chunkImg,t,i,oe.original.width,oe.original.height):R.drawImage(r.chunkImg,10,10,oe.original.width,oe.original.height):((o=new Image).src=e,o.onload=function(){o.loaded=!0,w=e,ae[e]={original:o,cachedLevels:Ie(o)},oe=ae[e];const r=Re();r&&(void 0!==t&&void 0!==i?R.drawImage(r.chunkImg,t,i,oe.original.width,oe.original.height):R.drawImage(r.chunkImg,10,10,oe.original.width,oe.original.height),V=!1,ye.fire("imageLoad",{state:"success",msg:o}),console.timeEnd("imgload"))},o.onerror=function(e){ye.fire("imageLoad",{state:"error",msg:e})})}else{var o;oe&&oe.loaded&&re?void 0!==t&&void 0!==i?R.drawImage(re,t,i):R.drawImage(re,10,10):((o=new Image).src=e,o.onload=function(){o.loaded=!0,w=e,oe=o,re||((re=document.createElement("canvas")).width=o.width,re.height=o.height,se=re.getContext("2d"),void 0!==t&&void 0!==i?se.drawImage(o,t,i):se.drawImage(o,10,10)),void 0!==t&&void 0!==i?R.drawImage(re,t,i):R.drawImage(re,10,10),ye.fire("imageLoad",{state:"success",msg:o}),console.timeEnd("imgload")},o.onerror=function(e){ye.fire("imageLoad",{state:"error",msg:e})})}},s.prototype.setImage=function(e,t,i){var o,r=this;de?((o=new Image).src=e,o.onload=function(){o.loaded=!0,w=e,ae[e]={original:o,cachedLevels:Ie(o)},oe=ae[e];const s=Re();s&&(void 0!==t&&void 0!==i?R.drawImage(s.chunkImg,t,i,oe.original.width,oe.original.height):R.drawImage(s.chunkImg,10,10,oe.original.width,oe.original.height),V=!1,xe(),r.fire("imageLoad",{state:"success",msg:o}),console.timeEnd("imgload"))},o.onerror=function(e){r.fire("imageLoad",{state:"error",msg:e})}):(w=null,oe=null,re=null,se=null,(o=new Image).src=e,o.onload=function(){o.loaded=!0,w=e,oe=o,re||((re=document.createElement("canvas")).width=o.width,re.height=o.height,se=re.getContext("2d"),void 0!==t&&void 0!==i?se.drawImage(o,t,i):se.drawImage(o,10,10)),void 0!==t&&void 0!==i?R.drawImage(re,t,i):(console.log(w,e,o,re),R.drawImage(re,10,10)),xe(),r.fire("imageLoad",{state:"success",msg:o}),console.timeEnd("imgload")},o.onerror=function(e){r.fire("imageLoad",{state:"error",msg:e})})},s.prototype.toTop=function(e){for(var t=q,i=t.length,o=i-1;o>=0;o--)if(e===t[o]){t.splice(o,1);break}e.index=i-1,q.push(e)},s.prototype.addPlot=function(e){switch(e.type){case"rect":default:this.addRect(e);break;case"text":this.addText(e)}},s.prototype.delPlot=function(e){if(void 0===e)return q=[],V=!1,void ye.fire("removeAll");for(var t=q,i=t.length-1;i>=0;i--){var o=t[i];if(e.uuid===o.uuid){t.splice(i,1);break}}V=!1,ye.fire("removePlot",e)},s.prototype.getPlotById=function(e){for(var t,i=q,o=i.length-1;o>=0;o--)if(e===t.uuid){t=i[o];break}return t},s.prototype.selectPlot=function(e,t){if(void 0===e)return q=[],V=!1,void ye.fire("removeAll");for(var i=q,o=i.length-1;o>=0;o--){var r=i[o];t||(r.selected=!1),e.uuid===r.uuid&&(r.selected=!0)}V=!1,ye.fire("removePlot",e)},s.prototype.flyToPlot=function(e,t){if("[object String]"===Object.prototype.toString.call(e)&&(e=this.getPlotById(e)),"[object Object]"===Object.prototype.toString.call(e)&&e.uuid){var i=ze(),o=t||i.scale;let r=(e.x+e.w/2)*o,s=(e.y+e.h)*o,n=f.width/2,l=f.height/2;i.x=r-n,i.y=s-l,i.scale=o,Me(i)}},s.prototype.addRect=function(e){let t=new Be(e);e.selected&&(K=t),q.push(t),V=!1},s.prototype.addText=function(e){let t=new Ae(e);ie&&void 0===e.x?K=t:(ie=!1,Q=!1),e.selected&&(K=t),q.push(t),V=!1},s.prototype.clear=function(){var e=R.transformedPoint(0,0),t=R.transformedPoint(f.width,f.height);R.clearRect(e.x,e.y,t.x-e.x,t.y-e.y)},s.prototype.changeBgColor=function(e){e=e||"#ffffff",R.fillStyle=e},s.prototype.draw=function(){if(!ue&&!V){ze();var e=q;this.clear(),w&&this.addImage(w);for(var t=e.length,i=0;i<t;i++){var o=e[i];if(o.index=i,K!==o){if(void 0===o.x||void 0===o.y||"text"!==o.type&&(void 0===o.w||void 0===o.h))continue;e[i].draw(R)}}null!==K&&K.draw(R),V=!0}},s.prototype.getMouse=function(e){var t=Pe().left,i=Pe().top,o=Pe().offsetX,r=Pe().offsetY,s=Pe().flag;o+=E+U,r+=T+H;var n=0,l=0;return s?(n=e.pageX-o-t,l=e.pageY-r-i):(n=e.pageX-o+t,l=e.pageY-r+i),{x:n,y:l}},s.prototype.screenshot=function(e){return e=e||"png",f.toDataURL("image/"+e)},s.prototype.downLoad=function(e){var t=document.createElement("a");t.download="",t.href=this.screenshot(e),document.body.appendChild(t),t.click(),document.body.removeChild(t)},s.prototype.pause=function(){ue=!0,ne&&(cancelAnimationFrame(ne),ne=null)},s.prototype.resume=function(){ue=!1,this.render()},s.prototype.on=function(e,t,i){if("[object Function]"!==Object.prototype.toString.call(t))throw Error("CanvasPlot.on('"+e+"',fn). Parameter 'fn' must be a function.");!0===i?ge[e]=[t]:ge[e]&&ge[e]instanceof Array?ge[e].push(t):ge[e]=[t]},s.prototype.off=function(e,t){if(!0===e)return ge={};if("[object Function]"!==Object.prototype.toString.call(t))return ge[e]=[];if(ge[e]&&ge[e]instanceof Array){var i=ge[e],o=i.indexOf(t);if(o>-1)return i.splice(o,1)}},s.prototype.fire=function(e,t,i,o){var r=ge[e];if(r&&r instanceof Array)for(var s=0;s<r.length;s++)r[s]&&r[s].call(this,t,i,o)},s.prototype.drawRectBegin=function(e){Q=!0,ie=!1,te="rect",Z=e||!1},s.prototype.drawRectFinish=function(){Q=!1,te=void 0},s.prototype.setCanvasDragZoom=function(e){G=e},s.prototype.attrRect=function(e){for(var t=0;t<q.length;t++)for(var i in e)q[t][i]=e[i]},s.prototype.drawTextBegin=function(){Q=!0,ie=!0,te="text",Z=!0},s.prototype.drawTextFinish=function(){Q=!1,ie=!1,te=void 0},s.prototype.attrText=function(e){for(var t=0;t<q.length;t++)for(var i in e)q[t][i]=e[i]};var Be=function(e){this.x=e.x||0,this.y=e.y||0,this.w=e.w||1,this.h=e.h||1,this.fill=void 0===e.color?"rgba(255, 255, 255, 0)":e.color,this.strokeColor=void 0===e.borderColor?x:e.borderColor,this.lineWidth=void 0!==e.borderWidth?e.borderWidth:1,this.selected=e.selected||!1,this.delselected=e.delselected||!1,this.sideLength=10,this.rectColor=e.rectColor||v,this.fillColor=e.fillColor||p,this.selectionBorderColor=e.selectionBorderColor||g,this.disabled=e.disabled||!1,this.dragging=!1,this.resizing=!1,this.index=e.index||0,this.type="rect",this.uuid=e.uuid||i(),this.params=e.params||null};Be.prototype.draw=function(e){e.fillStyle=this.fill,e.fillRect(this.x,this.y,this.w,this.h),this.lineWidth&&!this.selected?(this.delselected?(e.strokeStyle="#ff0000",e.lineWidth=3):(e.strokeStyle=this.strokeColor,e.lineWidth=this.lineWidth),e.strokeRect(this.x,this.y,this.w,this.h)):this.selected&&(e.strokeStyle=this.selectionBorderColor||g,e.lineWidth=y,e.strokeRect(this.x,this.y,this.w,this.h),Q&&this.drawHandles(e))},Be.prototype.drawHandles=function(e){o(this.x,this.y,this.sideLength,e,this.rectColor,this.fillColor),o(this.x+this.w,this.y,this.sideLength,e,this.rectColor,this.fillColor),o(this.x,this.y+this.h,this.sideLength,e,this.rectColor,this.fillColor),o(this.x+this.w,this.y+this.h,this.sideLength,e,this.rectColor,this.fillColor),o(this.x+this.w/2,this.y,this.sideLength,e,this.rectColor,this.fillColor),o(this.x+this.w,this.y+this.h/2,this.sideLength,e,this.rectColor,this.fillColor),o(this.x,this.y+this.h/2,this.sideLength,e,this.rectColor,this.fillColor),o(this.x+this.w/2,this.y+this.h,this.sideLength,e,this.rectColor,this.fillColor)},Be.prototype.contains=function(e,t){return!!this.getCheckSideLengthResult(e,t)||!0===this.getContainsRectResult(e,t)||void 0},Be.prototype.getContainsRectResult=function(e,t){var i=Pe().left,o=Pe().top,r=ze(),s=this.w*r.scale,n=this.h*r.scale,l=this.x*r.scale+i,a=this.y*r.scale+o;return(s>=0?l<=e&&l+s>=e:l>=e&&l+s<=e)&&(n>=0?a<=t&&a+n>=t:a>=t&&a+n<=t)},Be.prototype.getCheckSideLengthResult=function(e,t){var i=Pe().left,o=Pe().top,s=ze(),n=this.w*s.scale,l=this.h*s.scale,a=this.sideLength*s.scale,d=this.x*s.scale+i,c=this.y*s.scale+o;return r(e,t,d,c,a)?"topL":r(e,t,d+n/2,c,a)?"topM":r(e,t,d+n,c,a)?"topR":r(e,t,d+n,c+l/2,a)?"rightM":r(e,t,d,c+l,a)?"bottomL":r(e,t,d+n/2,c+l,a)?"bottomM":r(e,t,d+n,c+l,a)?"bottomR":r(e,t,d,c+l/2,a)?"leftM":void 0};var Ae=function(e){this.x=e.x||0,this.y=e.y||0,this.bold=void 0===e.bold?"":"bold",this.fontSize=e.fontSize||16,this.fontFamily=e.fontFamily||"Arial",this.text=e.text||"这是文本",this.fillColor=void 0===e.fillColor?"rgba(0, 0, 0, 1)":e.fillColor,this.strokeColor=void 0===e.strokeColor?"rgba(0, 0, 0, 1)":e.strokeColor,this.selected=e.selected||!1,this.delselected=e.delselected||!1,this.disabled=e.disabled||!1,this.fill=void 0===e.fill||e.fill,this.stroke=void 0!==e.stroke&&e.stroke,this.textAlign=e.textAlign||"left",this.textBaseline=e.textBaseline||"top",this.shadowColor=e.shadowColor||"rgba(0,0,0,0)",this.shadowBlur=e.shadowBlur||10,this.shadowOffsetX=e.shadowOffsetX||5,this.shadowOffsetY=e.shadowOffsetY||5,this.index=e.index||0,this.type="text",this.uuid=e.uuid||i(),this.params=e.params||null};Ae.prototype.draw=function(e){e.font=this.bold+""+this.fontSize+"px "+this.fontFamily,e.fillStyle=this.fillColor,e.strokeColor=this.strokeColor,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,this.selected?(e.fillStyle=g,e.strokeStyle=g):(e.fillStyle=this.fillColor,e.strokeStyle=this.strokeColor),this.delselected&&(e.fillStyle="#ff0000",e.strokeStyle="#ff0000"),this.fill&&e.fillText(this.text,this.x,this.y),this.stroke&&e.strokeText(this.text,this.x,this.y);const t=e.measureText(this.text),i=t.fontBoundingBoxAscent+t.fontBoundingBoxDescent;this.w=t.width,this.h=i},Ae.prototype.contains=function(e,t){if(this.getContainsTextResult(e,t))return!0},Ae.prototype.getContainsTextResult=function(e,t){var i=Pe().left,o=Pe().top,r=ze(),s=this.w*r.scale,n=this.h*r.scale,l=this.x*r.scale+i,a=this.y*r.scale+o;return(s>=0?l<=e&&l+s>=e:l>=e&&l+s<=e)&&(n>=0?a<=t&&a+n>=t:a>=t&&a+n<=t)},function(e){if(!ue){var t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=t.createSVGMatrix();e.getTransform=function(){return i};var o=[],r=e.save;e.save=function(){if(G)return o.push(i.translate(0,0)),r.call(e)};var s=e.restore;e.restore=function(){if(G)return i=o.pop(),s.call(e)};var n=e.scale;e.scale=function(t,o){if(G)return i=i.scaleNonUniform(t,o),n.call(e,t,o)};var l=e.rotate;e.rotate=function(t){if(G)return i=i.rotate(180*t/Math.PI),l.call(e,t)};var a=e.translate;e.translate=function(t,o){if(G)return i=i.translate(t,o),a.call(e,t,o)};var d=e.transform;e.transform=function(o,r,s,n,l,a){if(G){var c=t.createSVGMatrix();return c.a=o,c.b=r,c.c=s,c.d=n,c.e=l,c.f=a,i=i.multiply(c),d.call(e,o,r,s,n,l,a)}};var c=e.setTransform;e.setTransform=function(t,o,r,s,n,l){if(G)return i.a=t,i.b=o,i.c=r,i.d=s,i.e=n,i.f=l,c.call(e,t,o,r,s,n,l)};var f=t.createSVGPoint();e.transformedPoint=function(e,t){if(G)return f.x=e,f.y=t,f.matrixTransform(i.inverse())}}}(R),this.render()}},n="1.2.5",console.log("canvasPlot.js v1.2.5  https://www.gjtool.cn"),void 0===(o=function(){return s(r,n)}.call(t,i,t,e))||(e.exports=o),window&&(window.CanvasPlot=s(r,n))}},t={};!function i(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,i),s.exports}(894)})();